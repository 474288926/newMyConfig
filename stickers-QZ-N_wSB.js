import{G as e}from"./lil-gui.esm-5OOmdJFK.js";import{D as t,H as a,F as s,a as r,L as n,b as o,S as i,P as l,W as c,A as d,O as p,T as h,c as m,d as u,M as f,E as w,e as g,f as y}from"./OrbitControls--o0rLgAM.js";import{d as E,r as b,o as v,s as A,c as R,e as M,f as F}from"./index-7WJyOSKY.js";class k extends t{constructor(e){super(e),this.type=a}parse(e){const t=function(e,t){switch(e){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(t||""))}},n=function(e,t,a){t=t||1024;let s=e.pos,r=-1,n=0,o="",i=String.fromCharCode.apply(null,new Uint16Array(e.subarray(s,s+128)));for(;0>(r=i.indexOf("\n"))&&n<t&&s<e.byteLength;)o+=i,n+=i.length,s+=128,i+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(s,s+128)));return-1<r&&(!1!==a&&(e.pos+=n+r+1),o+i.slice(0,r))},o=function(e,t,a,s){const r=e[t+3],n=Math.pow(2,r-128)/255;a[s+0]=e[t+0]*n,a[s+1]=e[t+1]*n,a[s+2]=e[t+2]*n,a[s+3]=1},i=function(e,t,a,s){const n=e[t+3],o=Math.pow(2,n-128)/255;a[s+0]=r.toHalfFloat(Math.min(e[t+0]*o,65504)),a[s+1]=r.toHalfFloat(Math.min(e[t+1]*o,65504)),a[s+2]=r.toHalfFloat(Math.min(e[t+2]*o,65504)),a[s+3]=r.toHalfFloat(1)},l=new Uint8Array(e);l.pos=0;const c=function(e){const a=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,r=/^\s*FORMAT=(\S+)\s*$/,o=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,i={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,c;for((e.pos>=e.byteLength||!(l=n(e)))&&t(1,"no header found"),(c=l.match(/^#\?(\S+)/))||t(3,"bad initial token"),i.valid|=1,i.programtype=c[1],i.string+=l+"\n";l=n(e),!1!==l;)if(i.string+=l+"\n","#"!==l.charAt(0)){if((c=l.match(a))&&(i.gamma=parseFloat(c[1])),(c=l.match(s))&&(i.exposure=parseFloat(c[1])),(c=l.match(r))&&(i.valid|=2,i.format=c[1]),(c=l.match(o))&&(i.valid|=4,i.height=parseInt(c[1],10),i.width=parseInt(c[2],10)),2&i.valid&&4&i.valid)break}else i.comments+=l+"\n";return 2&i.valid||t(3,"missing format specifier"),4&i.valid||t(3,"missing image size specifier"),i}(l),d=c.width,p=c.height,h=function(e,a,s){const r=a;if(r<8||r>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);r!==(e[2]<<8|e[3])&&t(3,"wrong scanline width");const n=new Uint8Array(4*a*s);n.length||t(4,"unable to allocate buffer space");let o=0,i=0;const l=4*r,c=new Uint8Array(4),d=new Uint8Array(l);let p=s;for(;p>0&&i<e.byteLength;){i+4>e.byteLength&&t(1),c[0]=e[i++],c[1]=e[i++],c[2]=e[i++],c[3]=e[i++],2==c[0]&&2==c[1]&&(c[2]<<8|c[3])==r||t(3,"bad rgbe scanline format");let a,s=0;for(;s<l&&i<e.byteLength;){a=e[i++];const r=a>128;if(r&&(a-=128),(0===a||s+a>l)&&t(3,"bad scanline data"),r){const t=e[i++];for(let e=0;e<a;e++)d[s++]=t}else d.set(e.subarray(i,i+a),s),s+=a,i+=a}const h=r;for(let e=0;e<h;e++){let t=0;n[o]=d[e+t],t+=r,n[o+1]=d[e+t],t+=r,n[o+2]=d[e+t],t+=r,n[o+3]=d[e+t],o+=4}p--}return n}(l.subarray(l.pos),d,p);let m,u,f;switch(this.type){case s:f=h.length/4;const e=new Float32Array(4*f);for(let a=0;a<f;a++)o(h,4*a,e,4*a);m=e,u=s;break;case a:f=h.length/4;const t=new Uint16Array(4*f);for(let a=0;a<f;a++)i(h,4*a,t,4*a);m=t,u=a;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:d,height:p,data:m,header:c.string,gamma:c.gamma,exposure:c.exposure,type:u}}setDataType(e){return this.type=e,this}load(e,t,r,i){return super.load(e,(function(e,r){switch(e.type){case s:case a:e.colorSpace=n,e.minFilter=o,e.magFilter=o,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)}),r,i)}}const x={class:"flex-1 overflow-hidden"},H=E({__name:"stickers",setup(t){const a=b(null),s=new i,r=new l(45,1,.1,1e3);r.position.set(2,2,1),r.lookAt(0,0,0);const o=new c,E=new d(5);s.add(E);const H=new p(r,o.domElement),L=new e;L.title("控制器");const U=L.domElement;U.style.top="140px",U.style.right="32px";const S=new h,G=S.load("/src/assets/three/stickers/color.jpg");G.colorSpace=m;const B=S.load("/src/assets/three/stickers/ambientOcclusion.jpg"),C=S.load("/src/assets/three/stickers/roughness.jpg"),T=new u(1,2),j=new f({color:"#fff",map:G,transparent:!0,aoMap:B,specularMap:C,reflectivity:.3});(new k).load("/src/assets/three/hdr/003.hdr",(e=>{Object.assign(e,{mapping:w}),s.background=e,s.environment=e,j.envMap=e})),L.add(j,"aoMapIntensity",0,1).name("ao贴图强度"),L.add(G,"colorSpace",{sRGB:m,linear:n}).onChange((()=>{G.needsUpdate=!0}));const O=new g(T,j),$=new y(16777215,1);$.position.set(2,3,4),s.add($);const I=()=>{H.update(),requestAnimationFrame(I),o.render(s,r)};return v((async()=>{var e,t,r;await A(),a.value&&(a.value.appendChild(U),o.setSize(null==(e=a.value)?void 0:e.clientWidth,null==(t=a.value)?void 0:t.clientHeight),null==(r=a.value)||r.appendChild(o.domElement)),s.add(O),H.update(),I()})),(e,t)=>(R(),M("div",x,[F("div",{ref_key:"canvasRef",ref:a,class:"h-full"},null,512)]))}});export{H as default};
