import{G as e}from"./lil-gui.esm-5OOmdJFK.js";import{D as t,H as a,F as r,a as n,L as s,b as o,S as i,P as l,W as c,A as d,O as p,T as h,c as m,d as u,M as f,E as w,e as g,f as y}from"./OrbitControls--o0rLgAM.js";import{d as E,r as b,o as v,s as A,c as R,e as M,f as F}from"./index-6nTlCzI1.js";class k extends t{constructor(e){super(e),this.type=a}parse(e){const t=function(e,t){switch(e){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(t||""))}},s=function(e,t,a){t=t||1024;let r=e.pos,n=-1,s=0,o="",i=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));for(;0>(n=i.indexOf("\n"))&&s<t&&r<e.byteLength;)o+=i,s+=i.length,r+=128,i+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));return-1<n&&(!1!==a&&(e.pos+=s+n+1),o+i.slice(0,n))},o=function(e,t,a,r){const n=e[t+3],s=Math.pow(2,n-128)/255;a[r+0]=e[t+0]*s,a[r+1]=e[t+1]*s,a[r+2]=e[t+2]*s,a[r+3]=1},i=function(e,t,a,r){const s=e[t+3],o=Math.pow(2,s-128)/255;a[r+0]=n.toHalfFloat(Math.min(e[t+0]*o,65504)),a[r+1]=n.toHalfFloat(Math.min(e[t+1]*o,65504)),a[r+2]=n.toHalfFloat(Math.min(e[t+2]*o,65504)),a[r+3]=n.toHalfFloat(1)},l=new Uint8Array(e);l.pos=0;const c=function(e){const a=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,r=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,n=/^\s*FORMAT=(\S+)\s*$/,o=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,i={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,c;for((e.pos>=e.byteLength||!(l=s(e)))&&t(1,"no header found"),(c=l.match(/^#\?(\S+)/))||t(3,"bad initial token"),i.valid|=1,i.programtype=c[1],i.string+=l+"\n";l=s(e),!1!==l;)if(i.string+=l+"\n","#"!==l.charAt(0)){if((c=l.match(a))&&(i.gamma=parseFloat(c[1])),(c=l.match(r))&&(i.exposure=parseFloat(c[1])),(c=l.match(n))&&(i.valid|=2,i.format=c[1]),(c=l.match(o))&&(i.valid|=4,i.height=parseInt(c[1],10),i.width=parseInt(c[2],10)),2&i.valid&&4&i.valid)break}else i.comments+=l+"\n";return 2&i.valid||t(3,"missing format specifier"),4&i.valid||t(3,"missing image size specifier"),i}(l),d=c.width,p=c.height,h=function(e,a,r){const n=a;if(n<8||n>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);n!==(e[2]<<8|e[3])&&t(3,"wrong scanline width");const s=new Uint8Array(4*a*r);s.length||t(4,"unable to allocate buffer space");let o=0,i=0;const l=4*n,c=new Uint8Array(4),d=new Uint8Array(l);let p=r;for(;p>0&&i<e.byteLength;){i+4>e.byteLength&&t(1),c[0]=e[i++],c[1]=e[i++],c[2]=e[i++],c[3]=e[i++],2==c[0]&&2==c[1]&&(c[2]<<8|c[3])==n||t(3,"bad rgbe scanline format");let a,r=0;for(;r<l&&i<e.byteLength;){a=e[i++];const n=a>128;if(n&&(a-=128),(0===a||r+a>l)&&t(3,"bad scanline data"),n){const t=e[i++];for(let e=0;e<a;e++)d[r++]=t}else d.set(e.subarray(i,i+a),r),r+=a,i+=a}const h=n;for(let e=0;e<h;e++){let t=0;s[o]=d[e+t],t+=n,s[o+1]=d[e+t],t+=n,s[o+2]=d[e+t],t+=n,s[o+3]=d[e+t],o+=4}p--}return s}(l.subarray(l.pos),d,p);let m,u,f;switch(this.type){case r:f=h.length/4;const e=new Float32Array(4*f);for(let a=0;a<f;a++)o(h,4*a,e,4*a);m=e,u=r;break;case a:f=h.length/4;const t=new Uint16Array(4*f);for(let a=0;a<f;a++)i(h,4*a,t,4*a);m=t,u=a;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:d,height:p,data:m,header:c.string,gamma:c.gamma,exposure:c.exposure,type:u}}setDataType(e){return this.type=e,this}load(e,t,n,i){return super.load(e,(function(e,n){switch(e.type){case r:case a:e.colorSpace=s,e.minFilter=o,e.magFilter=o,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,n)}),n,i)}}const x={class:"flex-1 overflow-hidden"},H=E({__name:"stickers",setup(t){const a=b(null),r=new i,n=new l(45,1,.1,1e3);n.position.set(2,2,1),n.lookAt(0,0,0);const o=new c,E=new d(5);r.add(E);const H=new p(n,o.domElement),L=new e;L.title("控制器");const U=L.domElement;U.style.top="140px",U.style.right="32px";const S=new h,G=S.load("/three/stickers/color.jpg");G.colorSpace=m;const B=S.load("/three/stickers/ambientOcclusion.jpg"),C=S.load("/three/stickers/roughness.jpg"),T=new u(1,2),j=new f({color:"#fff",map:G,transparent:!0,aoMap:B,specularMap:C,reflectivity:.3});(new k).load("/three/hdr/003.hdr",(e=>{Object.assign(e,{mapping:w}),r.background=e,r.environment=e,j.envMap=e})),L.add(j,"aoMapIntensity",0,1).name("ao贴图强度"),L.add(G,"colorSpace",{sRGB:m,linear:s}).onChange((()=>{G.needsUpdate=!0}));const O=new g(T,j),$=new y(16777215,1);$.position.set(2,3,4),r.add($);const I=()=>{H.update(),requestAnimationFrame(I),o.render(r,n)};return v((async()=>{var e,t,n;await A(),a.value&&(a.value.appendChild(U),o.setSize(null==(e=a.value)?void 0:e.clientWidth,null==(t=a.value)?void 0:t.clientHeight),null==(n=a.value)||n.appendChild(o.domElement)),r.add(O),H.update(),I()})),(e,t)=>(R(),M("div",x,[F("div",{ref_key:"canvasRef",ref:a,class:"h-full"},null,512)]))}});export{H as default};
